!function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],2:[function(t,e,n){function r(){c=!1,u.length?h=u.concat(h):f=-1,h.length&&i()}function i(){if(!c){var t=setTimeout(r);c=!0;for(var e=h.length;e;){for(u=h,h=[];++f<e;)u[f].run();f=-1,e=h.length}u=null,c=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function s(){}var u,a=e.exports={},h=[],c=!1,f=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new o(t,e)),1!==h.length||c||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],4:[function(t,e,n){(function(e,r){function i(t,e){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(e)?r.showHidden=e:e&&n._extend(r,e),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),a(r,t,r.depth)}function o(t,e){var n=i.styles[e];return n?"["+i.colors[n][0]+"m"+t+"["+i.colors[n][1]+"m":t}function s(t,e){return t}function u(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function a(t,e,r){if(t.customInspect&&e&&k(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(r,t);return E(i)||(i=a(t,i,r)),i}var o=h(t,e);if(o)return o;var s=Object.keys(e),d=u(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),T(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(e);if(0===s.length){if(k(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(x(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(M(e))return t.stylize(Date.prototype.toString.call(e),"date");if(T(e))return c(e)}var m="",v=!1,w=["{","}"];if(y(e)&&(v=!0,w=["[","]"]),k(e)){var b=e.name?": "+e.name:"";m=" [Function"+b+"]"}if(x(e)&&(m=" "+RegExp.prototype.toString.call(e)),M(e)&&(m=" "+Date.prototype.toUTCString.call(e)),T(e)&&(m=" "+c(e)),0===s.length&&(!v||0==e.length))return w[0]+m+w[1];if(0>r)return x(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var z;return z=v?f(t,e,r,d,s):s.map(function(n){return l(t,e,r,d,n,v)}),t.seen.pop(),p(z,m,w)}function h(t,e){if(b(e))return t.stylize("undefined","undefined");if(E(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return v(e)?t.stylize(""+e,"number"):d(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,i){for(var o=[],s=0,u=e.length;u>s;++s)F(e,String(s))?o.push(l(t,e,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(l(t,e,n,r,i,!0))}),o}function l(t,e,n,r,i,o){var s,u,h;if(h=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]},h.get?u=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(u=t.stylize("[Setter]","special")),F(r,i)||(s="["+i+"]"),u||(t.seen.indexOf(h.value)<0?(u=g(n)?a(t,h.value,null):a(t,h.value,n-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n"))):u=t.stylize("[Circular]","special")),b(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+u}function p(t,e,n){var r=0,i=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function y(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return null==t}function v(t){return"number"==typeof t}function E(t){return"string"==typeof t}function w(t){return"symbol"==typeof t}function b(t){return void 0===t}function x(t){return z(t)&&"[object RegExp]"===H(t)}function z(t){return"object"==typeof t&&null!==t}function M(t){return z(t)&&"[object Date]"===H(t)}function T(t){return z(t)&&("[object Error]"===H(t)||t instanceof Error)}function k(t){return"function"==typeof t}function R(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function H(t){return Object.prototype.toString.call(t)}function S(t){return 10>t?"0"+t.toString(10):t.toString(10)}function O(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),A[t.getMonth()],e].join(" ")}function F(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var C=/%[sdj%]/g;n.format=function(t){if(!E(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(i(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(t).replace(C,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return t}}),u=r[n];o>n;u=r[++n])s+=g(u)||!z(u)?" "+u:" "+i(u);return s},n.deprecate=function(t,i){function o(){if(!s){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),s=!0}return t.apply(this,arguments)}if(b(r.process))return function(){return n.deprecate(t,i).apply(this,arguments)};if(e.noDeprecation===!0)return t;var s=!1;return o};var _,N={};n.debuglog=function(t){if(b(_)&&(_=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!N[t])if(new RegExp("\\b"+t+"\\b","i").test(_)){var r=e.pid;N[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else N[t]=function(){};return N[t]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=y,n.isBoolean=d,n.isNull=g,n.isNullOrUndefined=m,n.isNumber=v,n.isString=E,n.isSymbol=w,n.isUndefined=b,n.isRegExp=x,n.isObject=z,n.isDate=M,n.isError=T,n.isFunction=k,n.isPrimitive=R,n.isBuffer=t("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",O(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!z(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:2,inherits:1}],5:[function(t,e,n){e.exports=function(){var t,e,n,r,i,o;return e=new THREE.Color(0),o=new THREE.Color(1118481),n=new THREE.Color(9127187),i=new THREE.Color(2263842),t={NONE:0,DIRT:1,GRASS:2,UNKNOWN:255},r=function(r){switch(r){case t.NONE:return[e,e,e,e,e,e];case t.DIRT:return[n,n,n,n,n,n];case t.GRASS:return[i,n,n,n,n,n];default:return[o,o,o,o,o,o]}},{TYPE:t,getColor:r}}()},{}],6:[function(t,e,n){var r,i,o;r=t("./block"),o=t("./util"),i=function(){function t(t,e,n,r,i,s,u){this.offsetx=t,this.offsety=e,this.offsetz=n,this.size=r,this.heightMin=null!=i?i:0,this.heightRange=null!=s?s:128,this.seed=null!=u?u:void 0,null==this.seed&&(this.seed=o.rand(1e6)),this.size2=this.size*this.size,this.heightMax=this.heightMin+this.heightRange-1,this.grid=new Uint8Array(this.size2*this.heightRange),this.faceIndex=new Int16Array(this.size2*this.heightRange*6),this.faceNum=0,this.generateMesh(32,.5,this.heightMin,this.heightMax),console.log("offset: "+this.offsetx+" "+this.offsetz)}return t.dir=[[0,1,0],[-1,0,0],[1,0,0],[0,0,-1],[0,0,1],[0,-1,0]],t.faceTable=[[[0,1,0],[0,1,1],[1,1,0],[1,1,1]],[[0,1,0],[0,0,0],[0,1,1],[0,0,1]],[[1,1,1],[1,0,1],[1,1,0],[1,0,0]],[[1,1,0],[1,0,0],[0,1,0],[0,0,0]],[[0,1,1],[0,0,1],[1,1,1],[1,0,1]],[[1,0,1],[0,0,1],[1,0,0],[0,0,0]]],t.indexTable=[[0,1,2],[2,1,3]],t.prototype.gridify=function(t,e,n){return{x:Math.floor(t),y:Math.floor(e),z:Math.floor(n)}},t.prototype.indexify=function(t,e,n){var r,i,o;return r=t-this.offsetx,i=e-this.offsety,o=n-this.offsetz,r>=0&&r<this.size&&o>=0&&o<this.size&&this.heightMin<=i&&i<=this.heightMax?r+o*this.size+i*this.size2:-1},t.prototype.iindexify=function(t){return{x:t%this.size+this.offsetx,z:t%this.size2/this.size+this.offsetz|0,y:t/this.size2+this.offsety|0}},t.prototype.gridindexify=function(t,e,n){var r,i,o,s;return r=this.gridify(t,e,n),i=r.x,o=r.y,s=r.z,this.indexify(i,o,s)},t.prototype.getType=function(t,e,n){var i;return i=this.indexify(t,e,n),0>i?r.TYPE.NONE:this.grid[i]},t.prototype.getFaceFromNormal=function(t,e,n){return t*t*(3+t)/2+e*e*(5-5*e)/2+n*n*(7+n)/2},t.prototype.getInvFaceFromNormal=function(t,e,n){return t*t*(3-t)/2+e*e*(5+5*e)/2+n*n*(7-n)/2},t.prototype.removeFace=function(t,e,n){var r,i,o,s,u,a,h,c,f,l,p,y,d,g,m,v,E,w,b,x,z;if(r=this.geometry.attributes,d=r.position,y=r.normal,i=r.color,h=r.index,u=6*t+e,s=this.faceIndex[u],0>s)return!1;if(this.faceIndex[u]=-1,this.faceNum--,z=6*this.faceNum,s!==z){for(g=[0,1,2,5],m=[],f=0,l=g.length;l>f;f++){for(a=g[f],o=3*h.array[s+a],v=3*h.array[z+a],n(o,3),x=[],b=[],c=p=0;3>p;c=++p)x.push(d.array[v+c]),d.array[o+c]=d.array[v+c],b.push(y.array[v+c]),y.array[o+c]=y.array[v+c],i.array[o+c]=i.array[v+c];0===a?(w=this.gridindexify(x[0],x[1],x[2]),E=this.getFaceFromNormal(b[0],b[1],b[2]),m.push(this.faceIndex[6*w+E]=s)):m.push(void 0)}return m}},t.prototype.addFace=function(e,n,i,s,u){var a,h,c,f,l,p,y,d,g,m,v;return a=this.geometry.attributes,d=a.position,p=a.normal,c=a.color,l=a.index,m=6*this.faceNum,g=l.array[m-1]+1,v=3*g,h=r.getColor(u)[s],y=1e-5,f=this.indexify(e,n,i),this.faceIndex[6*f+s]=m,t.indexTable.forEach(function(t,e){return l.array[m+3*e]=t[0]+g,l.array[m+3*e+1]=t[1]+g,l.array[m+3*e+2]=t[2]+g}),t.faceTable[s].forEach(function(r){return function(r){return d.array[v]=r[0]+e+(r[0]<.5?y:-y),d.array[v+1]=r[1]+n+(r[1]<.5?y:-y),d.array[v+2]=r[2]+i+(r[2]<.5?y:-y),p.array[v]=t.dir[s][0],p.array[v+1]=t.dir[s][1],p.array[v+2]=t.dir[s][2],c.array[v]=h.r+o.randf(h.r/4),c.array[v+1]=h.g+o.randf(h.g/4),c.array[v+2]=h.b+o.randf(h.b/4),v+=3}}(this)),this.faceNum++},t.prototype.removeBlock=function(e,n,r){var i,o,s,u,a,h,c,f,l,p,y,d,g,m,v,E,w,b;if(a=this.indexify(e,n,r),!(0>a)){for(this.grid[a]=0,l=[],s=h=0;6>h;s=++h)this.removeFace(a,s,function(t,e){var n;return n=!0,_.forEach(l,function(r,i){var o,s;return r[0]+r[1]<t?!0:t+e<r[0]?!0:(s=Math.min(r[0],t),o=Math.max(r[0]+r[1],t+e),l[i][0]=s,l[i][1]=o-s,n=!1)}),n?l.push([t,e]):void 0});for(d=6*this.faceNum,y=this.geometry.attributes.index.array[d-1]+1,g=3*y,w=g,v=0,b=d,E=0,p=t.dir,f=0,c=p.length;c>f;f++)i=p[f],m=this.getType(e+i[0],n+i[1],r+i[2]),0!==m&&(o=this.getInvFaceFromNormal(i[0],i[1],i[2]),this.addFace(e+i[0],n+i[1],r+i[2],o,m),E+=6,v+=12);return v>0&&(u=!0,_.forEach(l,function(t,e){var n,r;return t[0]+t[1]<w?!0:w+v<t[0]?!0:(r=Math.min(t[0],w),n=Math.max(t[0]+t[1],w+v),l[e][0]=r,l[e][1]=n-r,u=!1)}),u&&l.push([w,v])),E>0&&this.updateGeometry("index",[[b,E]]),l.length>0&&(this.updateGeometry("position",l),this.updateGeometry("color",l),this.updateGeometry("normal",l)),this.geometry.drawcalls[0].count=6*this.faceNum}},t.prototype.addBlock=function(e,n,r,i){var o,s,u,a,h,c,f,l,p,y,d,g,m,v,E,w,b,x;if(a=this.indexify(e,n,r),!(0>a)){for(this.grid[a]=i,p=[],y=t.dir,h=0,c=y.length;c>h;h++)o=y[h],i=this.getType(e+o[0],n+o[1],r+o[2]),0!==i&&(a=this.indexify(e+o[0],n+o[1],r+o[2]),s=this.getInvFaceFromNormal(o[0],o[1],o[2]),this.removeFace(a,s,function(t,e){var n;return n=!0,_.forEach(p,function(r,i){var o,s;return r[0]+r[1]<t?!0:t+e<r[0]?!0:(s=Math.min(r[0],t),o=Math.max(r[0]+r[1],t+e),p[i][0]=s,p[i][1]=o-s,n=!1)}),n?p.push([t,e]):void 0}));for(m=6*this.faceNum,g=this.geometry.attributes.index.array[m-1]+1,v=3*g,b=v,E=0,x=m,w=0,d=t.dir,l=0,f=d.length;f>l;l++)o=d[l],i=this.getType(e+o[0],n+o[1],r+o[2]),0===i&&(s=this.getFaceFromNormal(o[0],o[1],o[2]),this.addFace(e,n,r,s,this.getType(e,n,r)),w+=6,E+=12);return E>0&&(u=!0,_.forEach(p,function(t,e){var n,r;return t[0]+t[1]<b?!0:b+E<t[0]?!0:(r=Math.min(t[0],b),n=Math.max(t[0]+t[1],b+E),p[e][0]=r,p[e][1]=n-r,u=!1)}),u&&p.push([b,E])),w>0&&this.updateGeometry("index",[[x,w]]),p.length>0&&(this.updateGeometry("position",p),this.updateGeometry("color",p),this.updateGeometry("normal",p)),this.geometry.drawcalls[0].count=6*this.faceNum,this.geometry.computeBoundingSphere()}},t.prototype.updateGeometry=function(t,e){return THREE.updateGeometry(this.geometry,t,e)},t.prototype.getHeight=function(t,e){var n,r,i,o,s;for(n=i=o=this.heightMax,s=this.heightMin;s>=o?s>=i:i>=s;n=s>=o?++i:--i)if(r=this.indexify(t,n,e),0!==this.grid[r])return n;return this.heightMin},t.prototype.generateMesh=function(e,n,i,s){var u,a,h,c,f,l,p,y;return c=new Int16Array(this.size2),h=this.size2*this.heightMax*3/2,console.log("faceMax: "+h),function(t){return function(){var r,u,a,h,f,l,p,y,d,g,m,v,E;for(r=i,u=s,a=l=0,g=t.size2;g>=0?g>l:l>g;a=g>=0?++l:--l){for(v=(a%t.size+t.offsetx+2)/2,E=((a/t.size+t.offsetz|0)+3)/2,d=2,f=p=0;4>p;f=++p)c[a]+=o.noise(v/d,E/d,t.seed)*d,d*=4;for(c[a]=~~Math.max(i,Math.min(s,c[a]*n+e)),h=y=0,m=c[a];m>=0?m>=y:y>=m;h=m>=0?++y:--y)h===c[a]?t.grid[a+h*t.size2]=2:t.grid[a+h*t.size2]=1;r=Math.max(r,c[a]),u=Math.min(u,c[a])}return console.log("height: ["+u+", "+r+"]")}}(this)(),this.geometry=new THREE.BufferGeometry,this.material=new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors}),y=new Float32Array(4*h*3),f=new Uint32Array(2*h*3),l=new Float32Array(4*h*3),u=new Float32Array(4*h*3),a=0,p=1e-5,this.grid.forEach(function(e){return function(n,i){var s,h,c,d,g,m,v;{if(0!==n)return d=e.iindexify(i),g=d.x,m=d.y,v=d.z,s=r.getColor(e.getType(g,m,v)),t.dir.forEach(function(n,r){var h;return h=e.getType(g+n[0],m+n[1],v+n[2]),0===h?(e.faceNum++,t.faceTable[r].forEach(function(t,e){var n;return y[12*a+3*e+0]=t[0]+g+(t[0]<.5?p:-p),y[12*a+3*e+1]=t[1]+m+(t[1]<.5?p:-p),y[12*a+3*e+2]=t[2]+v+(t[2]<.5?p:-p),l[12*a+3*e+0]=1===r?-1:2===r?1:0,l[12*a+3*e+1]=5===r?-1:0===r?1:0,l[12*a+3*e+2]=3===r?-1:4===r?1:0,n=s[r],u[12*a+3*e+0]=n.r+o.randf(n.r/4),u[12*a+3*e+1]=n.g+o.randf(n.g/4),u[12*a+3*e+2]=n.b+o.randf(n.b/4)}),e.faceIndex[6*i+r]=6*a,t.indexTable.forEach(function(t,e){return f[6*a+3*e+0]=t[0]+4*a,f[6*a+3*e+1]=t[1]+4*a,f[6*a+3*e+2]=t[2]+4*a}),a++):e.faceIndex[6*i+r]=-1});for(h=c=0;6>c;h=++c)e.faceIndex[6*i+h]=-1}}}(this)),this.geometry.addAttribute("position",new THREE.DynamicBufferAttribute(y,3)),this.geometry.addAttribute("index",new THREE.DynamicBufferAttribute(f,3)),this.geometry.addAttribute("normal",new THREE.DynamicBufferAttribute(l,3)),this.geometry.addAttribute("color",new THREE.DynamicBufferAttribute(u,3)),this.geometry.computeBoundingSphere(),this.geometry.drawcalls.push({start:0,count:2*this.faceNum*3,index:0}),this.mesh=new THREE.Mesh(this.geometry,this.material)},t}(),e.exports=i},{"./block":5,"./util":12}],7:[function(t,e,n){var r,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},o={}.hasOwnProperty;r=function(){function t(t){var e,n,r,s,u,a,h,c,f;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},s=function(t){return function(e,n){return{key:t.keyMap[e]||String.fromCharCode(e).toLowerCase(),status:n}}}(this),n=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(e){return s.call(t,e.keyCode,!0)}}(this)),r=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(e){return s.call(t,e.keyCode,!1)}}(this)),n.merge(r).filter(function(t){var e;return e=t.key.charCodeAt(0),e>47&&58>e||e>96&&123>e}).onValue(function(t){return function(e){var n;return t.keys[e.key]=e.status,e.status&&null!=(n=t.listener[e.key])?n.forEach(function(t){return t()}):void 0}}(this)),e=[THREE.MOUSE.LEFT,THREE.MOUSE.RIGHT],u=function(t){return function(n){var r;return r={},e.forEach(function(t){return r[t]=[]}),Bacon.fromEventTarget(t.domElement,n).filter(function(t){var n;return n=t.button,i.call(e,n)>=0}).onValue(function(t){return r[t.button].forEach(function(e){return e(t.clientX,t.clientY)})}),[function(t,e){var n;return null!=(n=r[t])?n.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this),a=u("mousedown"),this.onMouseDown=a[0],this.offMouseDown=a[1],h=u("mouseup"),this.onMouseUp=h[0],this.offMouseUp=h[1],c=_.transform(u("dblclick"),function(t,e){return t.push(e.bind(this,THREE.MOUSE.LEFT))}),this.onDoubleClick=c[0],this.offDoubleClick=c[1],f=function(t){return function(){var n,r,i,s;return r={},n={},e.forEach(function(t){return n[t]=!1,r[t]=[]}),i=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),s=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),i.merge(s).onValue(function(t){return null!=n[t[0]]?n[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var e,i,s;i=[];for(e in r)o.call(r,e)&&(s=r[e],i.push(s.forEach(function(r){return n[e]?r(t.clientX,t.clientY):void 0})));return i}),[function(t,e){var n;return null!=(n=r[t])?n.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this)(),this.onMouseMove=f[0],this.offMouseMove=f[1],this.offAll=function(t){return function(){var n,r,i,s;e.forEach(function(e){return t.offMouseDown(e),t.offMouseUp(e),t.offMouseMove(e)}),t.offDoubleClick(),r=t.listener,i=[];for(n in r)o.call(r,n)&&(s=r[n],i.push(t.off(n)));return i}}(this)}return t.prototype.on=function(t,e){return this.listener[t]?this.listener[t].push(e):this.listener[t]=[e]},t.prototype.off=function(t,e){return null==e&&(e=allremove),_.remove(this.listener[t],function(t){return t===e})},t}(),e.exports=r},{}],8:[function(t,e,n){"use strict";var r,i;i=t("./scene"),r=function(){function t(){var t;Detector.webgl||Detector.addGetWebGLMessage(),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialiasing:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(10541295,1),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,$("#world").append(this.renderer.domElement),THREE.gl=this.renderer.context,THREE.updateGeometry=function(t,e,n){var r,i,o,s,u,a,h,c,f;for(r=t.attributes[e],i="index"===e?THREE.gl.ELEMENT_ARRAY_BUFFER:THREE.gl.ARRAY_BUFFER,THREE.gl.bindBuffer(i,r.buffer),f=[],u=0,a=n.length;a>u;u++)c=n[u],h=c[0],o=c[1],s=r.array.subarray(h,h+o),THREE.gl.bufferSubData(i,h*r.array.BYTES_PER_ELEMENT,s),f.push(s=null);return f},this.currentScene=void 0,t=function(t){return function(e){return t.currentScene.input.offAll(),t.currentScene=e}}(this),this.currentScene=new i(this.renderer,t),this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement),$(window).resize(function(t){return function(){var e,n;return n=window.innerWidth,e=window.innerHeight,t.renderer.setSize(n,e),t.currentScene.camera.aspect=n/e,t.currentScene.camera.updateProjectionMatrix()}}(this))}return t.prototype.animate=function(){var t;return requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.stats.begin(),this.renderer.clear(),null!=(t=this.currentScene)&&t.update(),this.stats.end()},t}(),$(function(){return(new r).animate()})},{"./scene":10}],9:[function(t,e,n){var r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("./input"),o=t("util").inspect,i=function(t){function e(t,n,r,i){this.world=t,e.__super__.constructor.call(this),this.input=this.world.input,this.velocity=new THREE.Vector3(0,0,0),this.canJump=!1,this.canDoubleJump=!1,this.doubleJumpFlag=!1,this.gravity=!0,this.height=1.7,this.width=.7,this.mode=1,this.sneak=!1,this.position.set(n,r,i),this.lookAt(new THREE.Vector3(n,0,i)),this.ray=new THREE.Raycaster,this.ray.near=0,this.ray.far=5,this.pickFlag=!1,this.input.onMouseDown(THREE.MOUSE.LEFT,function(t){return function(){return t.pickFlag=!0}}(this)),this.input.onMouseUp(THREE.MOUSE.LEFT,function(t){return function(){return t.pickFlag=!1}}(this))}return s(e,t),e.prototype.getCollider=function(){return this.collider=[this.position.clone().add(new THREE.Vector3(-this.width/2,-.5,-this.width/2)),this.position.clone().add(new THREE.Vector3(this.width/2,this.height-.5,this.width/2))]},e.prototype.getCell=function(){var t;return t={x:Math.floor(this.position.x),y:Math.floor(this.position.y),z:Math.floor(this.position.z)}},e.prototype.getAroundColliders=function(t,e){var n,r,i,o,s,u,a,h,c,f,l,p,y,d,g,m,v,E,w,b;for(d=[],l=this.getCell(),E=l.x,w=l.y,b=l.z,o=[],p=[-1,0,1],s=0,h=p.length;h>s;s++)for(n=p[s],y=[-1,0,1],u=0,c=y.length;c>u;u++)r=y[u],"x"===t&&o.push([e,n,r]),"y"===t&&o.push([n,e,r]),"z"===t&&o.push([n,r,e]);for(a=0,f=o.length;f>a;a++)i=o[a],g=E+i[0],m=w+i[1],v=b+i[2],this.world.terrain.getType(g,m,v)&&d.push(this.world.terrain.getCollider(g,m,v));return d},e.prototype.collides=function(t){var e;return e=this.getCollider(),t.some(function(t){return t[0].x>e[1].x?!1:t[0].y>e[1].y?!1:t[0].z>e[1].z?!1:t[1].x<e[0].x?!1:t[1].y<e[0].y?!1:t[1].z<e[0].z?!1:!0})},e.prototype.pick=function(){var t,e,n,r,i,o,s,u,a,h,c,f,l,p,y,d,g,m;if(c=this.position.clone().add(new THREE.Vector3(0,this.height-.75,0)),o=new THREE.Vector3(0,0,1),o.unproject(this.world.camera),e=o.sub(c).normalize(),this.ray.set(c,e),i=this.ray.intersectObjects(this.world.terrain.getMeshes()),i.length>0){if(r=i[0],n=r.face,t=r.object.geometry.attributes,l=t.position,s=t.normal,y=3*n.a,p=this.world.terrain.gridify(l.array[y],l.array[y+1],l.array[y+2]),d=p.x,g=p.y,m=p.z,this.input.keys.q)return this.world.terrain.removeBlock(d,g,m);if(this.input.keys.e&&(u=s.array[y],a=s.array[y+1],h=s.array[y+2],f=this.getCell(),f.x!==d+u||f.z!==m+h||f.y!==g+a&&f.y+1!==g+a))return this.world.terrain.addBlock(d+u,g+a,m+h,2)}},e.prototype.action=function(t){var e,n,r,i,o,s,u;for(n=.001,r=!1,this.velocity.x-=3*this.velocity.x*t,this.velocity.z-=3*this.velocity.z*t,Math.abs(this.velocity.x)<n&&(this.velocity.x=0),Math.abs(this.velocity.z)<n&&(this.velocity.z=0),this.gravity&&-this.velocity.y*t<.5&&(this.velocity.y-=9.8*2.7*t),s=["x","y","z"],i=0,o=s.length;o>i;i++)e=s[i],Math.abs(this.velocity[e])*t>.7&&(this.velocity[e]=.7*(this.velocity[e]<0?-1:1)/t);return this.input.keys.shift?this.canJump&&(this.sneak=!0):(r=!0,this.sneak=!1),u=this.sneak?2:12,this.input.keys.w&&(this.velocity.z-=u*t,r=!0),this.input.keys.a&&(this.velocity.x-=u*t,r=!0),this.input.keys.s&&(this.velocity.z+=u*t,r=!0),this.input.keys.d&&(this.velocity.x+=u*t,r=!0),this.input.keys.space&&!this.sneak?this.gravity?this.canDoubleJump&&(this.velocity.y=14,this.velocity.x*=3,this.velocity.z*=3,this.canDoubleJump=!1):this.canJump&&(this.velocity.y=8.5,this.canJump=!1,this.gravity=!0,this.doubleJumpFlag=!0):this.doubleJumpFlag&&(this.canDoubleJump=!0,this.doubleJumpFlag=!1),r?(this.gravity=!0,this.canJump=!1):void 0},e.prototype.hitCheck=function(t){var e,n,r,i,o,s,u,a,h,c,f,l,p,y,d;if(r=.001,l=this.position.clone(),this.translateX(this.velocity.x*t),this.translateZ(this.velocity.z*t),this.translateY(this.velocity.y*t),h={x:this.position.x-l.x,z:this.position.z-l.z,y:this.position.y-l.y},this.position.copy(l),this.sneak){for(p=["x","z"],i=0,s=p.length;s>i;i++)if(e=p[i],a=h[e],!(Math.abs(a)<r))if(c=this.position[e],this.position[e]+=a,n=this.getAroundColliders(e,0>a?-1:1),this.collides(n))this.position[e]=c;else{if(h.y>0)continue;f=this.position.y,this.position.y-=.5,n=this.getAroundColliders("y",-1),this.collides(n)||(this.position[e]=c),this.position.y=f}return this.velocity.y=0,this.gravity=!1}for(y=["x","z","y"],d=[],o=0,u=y.length;u>o;o++)e=y[o],a=h[e],Math.abs(a)<r||(c=this.position[e],this.position[e]+=a,n=this.getAroundColliders(e,0>a?-1:1),this.collides(n)?(this.position[e]=c,"y"===e?(this.velocity.y=0,0>a?(this.canJump=!0,this.canDoubleJump=!1,this.doubleJumpFlag=!1,d.push(this.gravity=!1)):d.push(void 0)):d.push(void 0)):d.push(void 0));return d},e.prototype.update=function(t){return this.pickFlag&&this.pick(),this.action(t),this.hitCheck(t)},e}(THREE.Object3D),e.exports=i},{"./input":7,util:4}],10:[function(t,e,n){var r,i,o,s,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=t("./input"),s=t("./world"),o=function(){function t(t,e){var n,i;this.renderer=t,this.transit=e,this.clock=new THREE.Clock,this.input=new r(document.body),this.scene=new THREE.Scene,i=window.innerWidth,n=window.innerHeight,this.camera=new THREE.PerspectiveCamera(72,i/n,.1,1e3)}return t.prototype.update=function(){return this.renderer.render(this.scene,this.camera)},t}(),i=function(t){function e(t,n){this.renderer=t,this.transit=n,e.__super__.constructor.call(this,this.renderer,this.transit),this.scene.fog=new THREE.Fog(16777215,100,1e3),this.controls=new THREE.PointerLockControls(this.camera),this.scene.add(this.controls.getObject()),this.world=new s(this.scene,this.input,this.camera,64),this.world.syncCamera(this.controls),this.input.onMouseDown(THREE.MOUSE.LEFT,function(t){return function(){return document.pointerLockElement?void 0:(t.controls.enabled=!0,document.body.requestPointerLock())}}(this))}return u(e,t),e.prototype.update=function(){var t;return this.controls.enabled&&(t=this.clock.getDelta(),t=Math.min(1/60,t),this.world.update(t),this.world.syncCamera(this.controls)),e.__super__.update.call(this)},e}(o),e.exports=i},{"./input":7,"./world":13}],11:[function(t,e,n){var r,i,o;o=t("./util"),r=t("./chunk"),i=function(){function t(e,n,i,s){var u,a,h,c,f,l,p;for(this.size=e,this.heightMin=null!=n?n:0,this.heightRange=null!=i?i:128,this.seed=null!=s?s:void 0,this.div=Math.floor(this.size/t.chunkSize),console.log("div: "+this.div),this.size2=this.size*this.size,null==this.seed&&(this.seed=o.rand(1e6)),console.log("seed: "+this.seed),this.chunk=[],f=a=0,l=this.div;l>=0?l>a:a>l;f=l>=0?++a:--a)for(c=h=0,p=this.div;p>=0?p>h:h>p;c=p>=0?++h:--h)u=new r(c*t.chunkSize,0,f*t.chunkSize,t.chunkSize,this.heightMin,this.heightRange,this.seed),this.chunk.push(u)}return t.chunkSize=16,t.prototype.getMeshes=function(){var t,e,n,r,i;for(i=[],r=this.chunk,e=0,n=r.length;n>e;e++)t=r[e],i.push(t.mesh);return i},t.prototype.chunkify=function(e,n,r){var i,o;return i=Math.floor(e/t.chunkSize),o=Math.floor(r/t.chunkSize),i>=0&&i<this.div&&o>=0&&o<this.div?i+o*this.div:-1},t.prototype.getHeight=function(t,e){var n;return n=this.chunkify(t,0,e),0>n?this.heightMin:this.chunk[n].getHeight(t,e)},t.prototype.gridify=function(t,e,n){return{x:Math.floor(t),y:Math.floor(e),z:Math.floor(n)}},t.prototype.getCollider=function(t,e,n){return[new THREE.Vector3(t,e,n),new THREE.Vector3(t+1,e+1,n+1)]},t.prototype.getType=function(t,e,n){var r;return r=this.chunkify(t,e,n),0>r?0:this.chunk[r].getType(t,e,n)},t.prototype.addBlock=function(t,e,n,r){var i;return i=this.chunkify(t,e,n),0>i?void 0:this.chunk[i].addBlock(t,e,n,r)},t.prototype.removeBlock=function(t,e,n){var r;return r=this.chunkify(t,e,n),0>r?void 0:this.chunk[r].removeBlock(t,e,n)},t}(),e.exports=i},{"./chunk":6,"./util":12}],12:[function(t,e,n){var r;r=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t.noise=function(){var t;return t=new ImprovedNoise,function(e,n,r){return t.noise(e,n,r)}}(),t}(),e.exports=r},{}],13:[function(t,e,n){var r,i,o;i=t("./terrain"),r=t("./player"),o=function(){function t(t,e,n,o){var s,u,a,h,c;for(this.scene=t,this.input=e,this.camera=n,this.size=o,c=100,this.terrain=new i(this.size,0,c),h=this.terrain.chunk,u=0,a=h.length;a>u;u++)s=h[u],this.scene.add(s.mesh);this.light=new THREE.DirectionalLight(16777215,.6),this.light.position.set(.5,.7,.3).normalize(),this.scene.add(this.light),this.light2=new THREE.HemisphereLight(16777215,1118481,.6),this.scene.add(this.light2),this.player=new r(this,this.size/2,this.terrain.getHeight(this.size/2,this.size/2)+c,this.size/2)}return t.prototype.update=function(t){return this.player.update(t)},t.prototype.syncCamera=function(t){var e;return e=this.player.position.clone().add(new THREE.Vector3(0,this.player.height-.75,0)),t.getObject().position.copy(e),this.player.rotation.copy(t.getObject().rotation)},t}(),e.exports=o},{"./player":9,"./terrain":11}]},{},[8]);
//# sourceMappingURL=bundle.js.map