!function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return i(n?n:t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){var r,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},o={}.hasOwnProperty;r=function(){function t(t){var e,n,r,s,u,c,a,h,f;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},s=function(t){return function(e,n){return{key:t.keyMap[e]||String.fromCharCode(e).toLowerCase(),status:n}}}(this),n=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(e){return s.call(t,e.keyCode,!0)}}(this)),r=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(e){return s.call(t,e.keyCode,!1)}}(this)),n.merge(r).filter(function(t){var e;return e=t.key.charCodeAt(0),e>47&&58>e||e>96&&123>e}).onValue(function(t){return function(e){var n;return t.keys[e.key]=e.status,e.status&&null!=(n=t.listener[e.key])?n.forEach(function(t){return t()}):void 0}}(this)),e=[THREE.MOUSE.LEFT,THREE.MOUSE.RIGHT],u=function(t){return function(n){var r;return r={},e.forEach(function(t){return r[t]=[]}),Bacon.fromEventTarget(t.domElement,n).filter(function(t){var n;return n=t.button,i.call(e,n)>=0}).onValue(function(t){return r[t.button].forEach(function(e){return e(t.clientX,t.clientY)})}),[function(t,e){var n;return null!=(n=r[t])?n.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this),c=u("mousedown"),this.onMouseDown=c[0],this.offMouseDown=c[1],a=u("mouseup"),this.onMouseUp=a[0],this.offMouseUp=a[1],h=_.transform(u("dblclick"),function(t,e){return t.push(e.bind(this,THREE.MOUSE.LEFT))}),this.onDoubleClick=h[0],this.offDoubleClick=h[1],f=function(t){return function(){var n,r,i,s;return r={},n={},e.forEach(function(t){return n[t]=!1,r[t]=[]}),i=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),s=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),i.merge(s).onValue(function(t){return null!=n[t[0]]?n[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var e,i,s;i=[];for(e in r)o.call(r,e)&&(s=r[e],i.push(s.forEach(function(r){return n[e]?r(t.clientX,t.clientY):void 0})));return i}),[function(t,e){var n;return null!=(n=r[t])?n.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this)(),this.onMouseMove=f[0],this.offMouseMove=f[1],this.offAll=function(t){return function(){var n,r,i,s;e.forEach(function(e){return t.offMouseDown(e),t.offMouseUp(e),t.offMouseMove(e)}),t.offDoubleClick(),r=t.listener,i=[];for(n in r)o.call(r,n)&&(s=r[n],i.push(t.off(n)));return i}}(this)}return t.prototype.on=function(t,e){return this.listener[t]?this.listener[t].push(e):this.listener[t]=[e]},t.prototype.off=function(t,e){return null==e&&(e=allremove),_.remove(this.listener[t],function(t){return t===e})},t}(),e.exports=r},{}],2:[function(t,e,n){"use strict";var r,i;i=t("./scene"),r=function(){function t(){var t;Detector.webgl||Detector.addGetWebGLMessage(),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialiasing:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(10541295,1),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,$("#world").append(this.renderer.domElement),this.currentScene=void 0,t=function(t){return function(e){return t.currentScene.input.offAll(),t.currentScene=e}}(this),this.currentScene=new i(this.renderer,t),this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement),$(window).resize(function(t){return function(){var e,n;return n=window.innerWidth,e=window.innerHeight,t.renderer.setSize(n,e),t.currentScene.camera.aspect=n/e,t.currentScene.camera.updateProjectionMatrix()}}(this))}return t.prototype.animate=function(){var t;return requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.stats.begin(),this.renderer.clear(),null!=(t=this.currentScene)&&t.update(),this.stats.end()},t}(),$(function(){return(new r).animate()})},{"./scene":4}],3:[function(t,e,n){var r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;r=function(t){function e(){}return i(e,t),e.prototype.update=function(){},e}(THREE.Object3D),e.exports=r},{}],4:[function(t,e,n){var r,i,o,s,u,c,a=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;r=t("./input"),i=t("./mob"),c=t("./world"),u=function(){function t(t,e){var n,i;this.renderer=t,this.transit=e,this.clock=new THREE.Clock,this.input=new r(document.body),this.scene=new THREE.Scene,i=window.innerWidth,n=window.innerHeight,this.camera=new THREE.PerspectiveCamera(72,i/n,1,1e3)}return t.prototype.update=function(){return this.renderer.render(this.scene,this.camera)},t}(),o=function(t){function e(t,n){this.renderer=t,this.transit=n,e.__super__.constructor.call(this,this.renderer,this.transit),this.camera.position.z=-50,this.camera.position.x=50,this.camera.position.y=100,this.controls=new THREE.OrbitControls(this.camera),this.world=new c(this.scene,128)}return a(e,t),e.prototype.update=function(){return this.world.update(this.clock.getDelta()),this.controls.update(),e.__super__.update.call(this)},e}(u),s=function(t){function e(t,n){var r,i;this.renderer=t,this.transit=n,e.__super__.constructor.call(this,this.renderer,this.transit),this.camera.position.z=100,this.controls=new THREE.PointerLockControls(this.camera),this.scene.add(this.controls.getObject()),r=new THREE.BoxGeometry(20,20,20),i=new THREE.MeshBasicMaterial({color:16711680,wireframe:!0}),this.mesh=new THREE.Mesh(r,i),this.scene.add(this.mesh),this.input.onMouseDown(THREE.MOUSE.LEFT,function(t){return function(){return console.log("poyo"),t.controls.enabled=!0,document.pointerLockElement?void 0:document.body.requestPointerLock()}}(this)),this.input.onDoubleClick(function(t){return function(){return t.controls.enabled=!1,document.pointerLockElement&&document.exitPointerLock(),console.log("transit OrbitScene"),t.transit(new o(t.renderer,t.transit))}}(this))}return a(e,t),e}(u),e.exports=o},{"./input":1,"./mob":3,"./world":7}],5:[function(t,e,n){var r,i;i=t("./util"),r=function(){function t(t,e){this.size=t,this.seed=e,this.size2=this.size*this.size,null==this.seed&&(this.seed=i.rand(1e6)),this.heightMin=0,this.heightRange=128,this.cell=new Uint8Array(this.size2*this.heightRange),this.generateMesh(32,.5,this.heightMin,this.heightMin+this.heightRange-1)}return t.prototype.getType=function(t,e,n){return 0>t||t>this.size-1?0:0>n||n>this.size-1?0:e<this.heightMin||e>this.heightMin+this.heightRange-1?0:this.cell[t+n*this.size+e*this.size2]},t.prototype.generateMesh=function(t,e,n,r){var o;return o=new Int16Array(this.size*this.size),function(s){return function(){var u,c,a;return u=n,c=r,function(){a=[];for(var t=0,e=s.size2;e>=0?e>t:t>e;e>=0?t++:t--)a.push(t);return a}.apply(this).forEach(function(a,h){var f,l,d,p;return d=(h%s.size+2)/2,p=((h/s.size|0)+3)/2,f=2,[0,1,2,3].forEach(function(t,e){return o[h]+=i.noise(d/f,p/f,s.seed)*f,f*=4}),o[h]=~~Math.max(n,Math.min(r,o[h]*e+t)),function(){l=[];for(var t=0,e=o[h];e>=0?e>=t:t>=e;e>=0?t++:t--)l.push(t);return l}.apply(this).forEach(function(t,e){return s.cell[h+e*s.size2]=1}),u=Math.max(u,o[h]),c=Math.min(c,o[h])}),console.log("height: ["+c+", "+u+"]")}}(this)(),this.geometry=new THREE.BufferGeometry,this.material=new THREE.MeshPhongMaterial({color:8800277,specular:1118481}),function(t){return function(){var e,n,r,i,o,s,u,c,a,h;return o=[[[0,1,0],[0,1,1],[1,1,0],[1,1,1]],[[0,1,0],[0,0,0],[0,1,1],[0,0,1]],[[1,1,1],[1,0,1],[1,1,0],[1,0,0]],[[1,1,0],[1,0,0],[0,1,0],[0,0,0]],[[0,1,1],[0,0,1],[1,1,1],[1,0,1]],[[1,0,1],[0,0,1],[1,0,0],[0,0,0]]],s=[[0,1,2],[2,1,3]],r=[[0,1,0],[-1,0,0],[1,0,0],[0,0,-1],[0,0,1],[0,-1,0]],i=0,function(){return t.cell.forEach(function(e,n){var o,s,u;if(0!==e)return o=n%t.size,u=n%t.size2/t.size|0,s=n/t.size2|0,r.forEach(function(e){var n;return n=t.getType(o+e[0],s+e[1],u+e[2]),0===n?i++:void 0})})}(),console.log("faceNum: "+i),h=new Float32Array(4*i*3),u=new Uint32Array(2*i*3),c=new Float32Array(4*i*3),e=new Float32Array(4*i*3),n=0,a=1e-5,t.cell.forEach(function(i,f){var l,d,p;if(0!==i)return l=f%t.size,p=f%t.size2/t.size|0,d=f/t.size2|0,r.forEach(function(r,i){var f;return f=t.getType(l+r[0],d+r[1],p+r[2]),0===f?(o[i].forEach(function(t,r){return h[12*n+3*r+0]=t[0]+l+(t[0]<.5?a:-a),h[12*n+3*r+1]=t[1]+d+(t[1]<.5?a:-a),h[12*n+3*r+2]=t[2]+p+(t[2]<.5?a:-a),c[12*n+3*r+0]=1===i?-1:2===i?1:0,c[12*n+3*r+1]=5===i?-1:0===i?1:0,c[12*n+3*r+2]=3===i?-1:4===i?1:0,e[12*n+3*r+0]=1,e[12*n+3*r+1]=1,e[12*n+3*r+2]=1}),s.forEach(function(t,e){return u[6*n+3*e+0]=t[0]+4*n,u[6*n+3*e+1]=t[1]+4*n,u[6*n+3*e+2]=t[2]+4*n}),n++):void 0})}),t.geometry.addAttribute("position",new THREE.BufferAttribute(h,3)),t.geometry.addAttribute("index",new THREE.BufferAttribute(u,3)),t.geometry.addAttribute("normal",new THREE.BufferAttribute(c,3)),t.geometry.addAttribute("color",new THREE.BufferAttribute(e,3))}}(this)(),this.mesh=new THREE.Mesh(this.geometry,this.material)},t}(),e.exports=r},{"./util":6}],6:[function(t,e,n){var r;r=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t.noise=function(){var t;return t=new ImprovedNoise,function(e,n,r){return t.noise(e,n,r)}}(),t}(),e.exports=r},{}],7:[function(t,e,n){var r,i;r=t("./terrain"),i=function(){function t(t,e){this.scene=t,this.size=e,this.terrain=new r(this.size),this.scene.add(this.terrain.mesh),this.light=new THREE.DirectionalLight(16777215,.6),this.light.position.set(.5,.7,.3).normalize(),this.scene.add(this.light),this.light2=new THREE.HemisphereLight(16777215,1118481,.3),this.scene.add(this.light2)}return t.prototype.update=function(t){},t}(),e.exports=i},{"./terrain":5}]},{},[2]);
//# sourceMappingURL=bundle.js.map