!function t(e,r,n){function i(s,u){if(!r[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return i(r?r:t)},c,c.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,r){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},{}],2:[function(t,e,r){function n(){c=!1,u.length?h=u.concat(h):l=-1,h.length&&i()}function i(){if(!c){var t=setTimeout(n);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u[l].run();l=-1,e=h.length}u=null,c=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function s(){}var u,a=e.exports={},h=[],c=!1,l=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new o(t,e)),1!==h.length||c||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(t,e,r){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],4:[function(t,e,r){(function(e,n){function i(t,e){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(e)?n.showHidden=e:e&&r._extend(n,e),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),a(n,t,n.depth)}function o(t,e){var r=i.styles[e];return r?"["+i.colors[r][0]+"m"+t+"["+i.colors[r][1]+"m":t}function s(t,e){return t}function u(t){var e={};return t.forEach(function(t,r){e[t]=!0}),e}function a(t,e,n){if(t.customInspect&&e&&R(e.inspect)&&e.inspect!==r.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(n,t);return E(i)||(i=a(t,i,n)),i}var o=h(t,e);if(o)return o;var s=Object.keys(e),d=u(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),T(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(e);if(0===s.length){if(R(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(x(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(M(e))return t.stylize(Date.prototype.toString.call(e),"date");if(T(e))return c(e)}var m="",v=!1,w=["{","}"];if(y(e)&&(v=!0,w=["[","]"]),R(e)){var b=e.name?": "+e.name:"";m=" [Function"+b+"]"}if(x(e)&&(m=" "+RegExp.prototype.toString.call(e)),M(e)&&(m=" "+Date.prototype.toUTCString.call(e)),T(e)&&(m=" "+c(e)),0===s.length&&(!v||0==e.length))return w[0]+m+w[1];if(0>n)return x(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var z;return z=v?l(t,e,n,d,s):s.map(function(r){return f(t,e,n,d,r,v)}),t.seen.pop(),p(z,m,w)}function h(t,e){if(b(e))return t.stylize("undefined","undefined");if(E(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return v(e)?t.stylize(""+e,"number"):d(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function l(t,e,r,n,i){for(var o=[],s=0,u=e.length;u>s;++s)_(e,String(s))?o.push(f(t,e,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(t,e,r,n,i,!0))}),o}function f(t,e,r,n,i,o){var s,u,h;if(h=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]},h.get?u=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(u=t.stylize("[Setter]","special")),_(n,i)||(s="["+i+"]"),u||(t.seen.indexOf(h.value)<0?(u=g(r)?a(t,h.value,null):a(t,h.value,r-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n"))):u=t.stylize("[Circular]","special")),b(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+u}function p(t,e,r){var n=0,i=t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function y(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return null==t}function v(t){return"number"==typeof t}function E(t){return"string"==typeof t}function w(t){return"symbol"==typeof t}function b(t){return void 0===t}function x(t){return z(t)&&"[object RegExp]"===k(t)}function z(t){return"object"==typeof t&&null!==t}function M(t){return z(t)&&"[object Date]"===k(t)}function T(t){return z(t)&&("[object Error]"===k(t)||t instanceof Error)}function R(t){return"function"==typeof t}function F(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function k(t){return Object.prototype.toString.call(t)}function H(t){return 10>t?"0"+t.toString(10):t.toString(10)}function C(){var t=new Date,e=[H(t.getHours()),H(t.getMinutes()),H(t.getSeconds())].join(":");return[t.getDate(),D[t.getMonth()],e].join(" ")}function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var O=/%[sdj%]/g;r.format=function(t){if(!E(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(i(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,o=n.length,s=String(t).replace(O,function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return t}}),u=n[r];o>r;u=n[++r])s+=g(u)||!z(u)?" "+u:" "+i(u);return s},r.deprecate=function(t,i){function o(){if(!s){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),s=!0}return t.apply(this,arguments)}if(b(n.process))return function(){return r.deprecate(t,i).apply(this,arguments)};if(e.noDeprecation===!0)return t;var s=!1;return o};var S,A={};r.debuglog=function(t){if(b(S)&&(S=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!A[t])if(new RegExp("\\b"+t+"\\b","i").test(S)){var n=e.pid;A[t]=function(){var e=r.format.apply(r,arguments);console.error("%s %d: %s",t,n,e)}}else A[t]=function(){};return A[t]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=y,r.isBoolean=d,r.isNull=g,r.isNullOrUndefined=m,r.isNumber=v,r.isString=E,r.isSymbol=w,r.isUndefined=b,r.isRegExp=x,r.isObject=z,r.isDate=M,r.isError=T,r.isFunction=R,r.isPrimitive=F,r.isBuffer=t("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",C(),r.format.apply(r,arguments))},r.inherits=t("inherits"),r._extend=function(t,e){if(!e||!z(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:2,inherits:1}],5:[function(t,e,r){var n,i=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},o={}.hasOwnProperty;n=function(){function t(t){var e,r,n,s,u,a,h,c,l;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},s=function(t){return function(e,r){return{key:t.keyMap[e]||String.fromCharCode(e).toLowerCase(),status:r}}}(this),r=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(e){return s.call(t,e.keyCode,!0)}}(this)),n=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(e){return s.call(t,e.keyCode,!1)}}(this)),r.merge(n).filter(function(t){var e;return e=t.key.charCodeAt(0),e>47&&58>e||e>96&&123>e}).onValue(function(t){return function(e){var r;return t.keys[e.key]=e.status,e.status&&null!=(r=t.listener[e.key])?r.forEach(function(t){return t()}):void 0}}(this)),e=[THREE.MOUSE.LEFT,THREE.MOUSE.RIGHT],u=function(t){return function(r){var n;return n={},e.forEach(function(t){return n[t]=[]}),Bacon.fromEventTarget(t.domElement,r).filter(function(t){var r;return r=t.button,i.call(e,r)>=0}).onValue(function(t){return n[t.button].forEach(function(e){return e(t.clientX,t.clientY)})}),[function(t,e){var r;return null!=(r=n[t])?r.push(e):void 0},function(t,e){return _.remove(n[t],function(t){return null!=e?t===e:!0})}]}}(this),a=u("mousedown"),this.onMouseDown=a[0],this.offMouseDown=a[1],h=u("mouseup"),this.onMouseUp=h[0],this.offMouseUp=h[1],c=_.transform(u("dblclick"),function(t,e){return t.push(e.bind(this,THREE.MOUSE.LEFT))}),this.onDoubleClick=c[0],this.offDoubleClick=c[1],l=function(t){return function(){var r,n,i,s;return n={},r={},e.forEach(function(t){return r[t]=!1,n[t]=[]}),i=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),s=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),i.merge(s).onValue(function(t){return null!=r[t[0]]?r[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var e,i,s;i=[];for(e in n)o.call(n,e)&&(s=n[e],i.push(s.forEach(function(n){return r[e]?n(t.clientX,t.clientY):void 0})));return i}),[function(t,e){var r;return null!=(r=n[t])?r.push(e):void 0},function(t,e){return _.remove(n[t],function(t){return null!=e?t===e:!0})}]}}(this)(),this.onMouseMove=l[0],this.offMouseMove=l[1],this.offAll=function(t){return function(){var r,n,i,s;e.forEach(function(e){return t.offMouseDown(e),t.offMouseUp(e),t.offMouseMove(e)}),t.offDoubleClick(),n=t.listener,i=[];for(r in n)o.call(n,r)&&(s=n[r],i.push(t.off(r)));return i}}(this)}return t.prototype.on=function(t,e){return this.listener[t]?this.listener[t].push(e):this.listener[t]=[e]},t.prototype.off=function(t,e){return null==e&&(e=allremove),_.remove(this.listener[t],function(t){return t===e})},t}(),e.exports=n},{}],6:[function(t,e,r){"use strict";var n,i;i=t("./scene"),n=function(){function t(){var t;Detector.webgl||Detector.addGetWebGLMessage(),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialiasing:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(10541295,1),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,$("#world").append(this.renderer.domElement),this.currentScene=void 0,t=function(t){return function(e){return t.currentScene.input.offAll(),t.currentScene=e}}(this),this.currentScene=new i(this.renderer,t),this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement),$(window).resize(function(t){return function(){var e,r;return r=window.innerWidth,e=window.innerHeight,t.renderer.setSize(r,e),t.currentScene.camera.aspect=r/e,t.currentScene.camera.updateProjectionMatrix()}}(this))}return t.prototype.animate=function(){var t;return requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.stats.begin(),this.renderer.clear(),null!=(t=this.currentScene)&&t.update(),this.stats.end()},t}(),$(function(){return(new n).animate()})},{"./scene":8}],7:[function(t,e,r){var n,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;n=t("./input"),o=t("util").inspect,i=function(t){function e(t,r,n,i){this.world=t,e.__super__.constructor.call(this),this.input=this.world.input,this.velocity=new THREE.Vector3(0,0,0),this.canJump=!1,this.canDoubleJump=!1,this.doubleJumpFlag=!1,this.gravity=!0,this.height=1.7,this.width=.7,this.mode=1,this.sneak=!1,this.position.set(r,n,i),this.lookAt(new THREE.Vector3(r,0,i)),this.ray=new THREE.Raycaster,this.ray.near=0,this.ray.far=5,this.pickFlag=!1,this.input.onMouseDown(THREE.MOUSE.LEFT,function(t){return function(){return t.pickFlag=!0}}(this)),this.input.onMouseUp(THREE.MOUSE.LEFT,function(t){return function(){return t.pickFlag=!1}}(this))}return s(e,t),e.prototype.getCollider=function(){return this.collider=[this.position.clone().add(new THREE.Vector3(-this.width/2,-.5,-this.width/2)),this.position.clone().add(new THREE.Vector3(this.width/2,this.height-.5,this.width/2))]},e.prototype.getCell=function(){var t;return t={x:Math.floor(this.position.x),y:Math.floor(this.position.y),z:Math.floor(this.position.z)}},e.prototype.getAroundColliders=function(t,e){var r,n,i,o,s,u,a,h,c,l,f,p,y,d,g,m,v,E,w,b;for(d=[],f=this.getCell(),E=f.x,w=f.y,b=f.z,o=[],p=[-1,0,1],s=0,h=p.length;h>s;s++)for(r=p[s],y=[-1,0,1],u=0,c=y.length;c>u;u++)n=y[u],"x"===t&&o.push([e,r,n]),"y"===t&&o.push([r,e,n]),"z"===t&&o.push([r,n,e]);for(a=0,l=o.length;l>a;a++)i=o[a],g=E+i[0],m=w+i[1],v=b+i[2],this.world.terrain.getType(g,m,v)&&d.push(this.world.terrain.getCollider(g,m,v));return d},e.prototype.collides=function(t){var e;return e=this.getCollider(),t.some(function(t){return t[0].x>e[1].x?!1:t[0].y>e[1].y?!1:t[0].z>e[1].z?!1:t[1].x<e[0].x?!1:t[1].y<e[0].y?!1:t[1].z<e[0].z?!1:!0})},e.prototype.pick=function(){var t,e,r,n,i,o,s,u,a,h,c,l,f,p,y,d,g,m;if(c=this.position.clone().add(new THREE.Vector3(0,this.height-.75,0)),o=new THREE.Vector3(0,0,1),o.unproject(this.world.camera),e=o.sub(c).normalize(),this.ray.set(c,e),i=this.ray.intersectObject(this.world.terrain.mesh),i.length>0){if(n=i[0],r=n.face,t=n.object.geometry.attributes,f=t.position,s=t.normal,y=3*r.a,p=this.world.terrain.getCell(f.array[y],f.array[y+1],f.array[y+2]),d=p.x,g=p.y,m=p.z,this.input.keys.q)return this.world.terrain.removeBlock(d,g,m);if(this.input.keys.e&&(u=s.array[y],a=s.array[y+1],h=s.array[y+2],l=this.getCell(),l.x!==d+u||l.z!==m+h||l.y!==g+a&&l.y+1!==g+a))return this.world.terrain.addBlock(d+u,g+a,m+h,2)}},e.prototype.action=function(t){var e,r,n,i,o,s,u;for(r=.001,n=!1,this.velocity.x-=3*this.velocity.x*t,this.velocity.z-=3*this.velocity.z*t,Math.abs(this.velocity.x)<r&&(this.velocity.x=0),Math.abs(this.velocity.z)<r&&(this.velocity.z=0),this.gravity&&-this.velocity.y*t<.5&&(this.velocity.y-=9.8*2.7*t),s=["x","y","z"],i=0,o=s.length;o>i;i++)e=s[i],Math.abs(this.velocity[e])*t>.7&&(this.velocity[e]=.7*(this.velocity[e]<0?-1:1)/t);return this.input.keys.shift?this.canJump&&(this.sneak=!0):(n=!0,this.sneak=!1),u=this.sneak?2:12,this.input.keys.w&&(this.velocity.z-=u*t,n=!0),this.input.keys.a&&(this.velocity.x-=u*t,n=!0),this.input.keys.s&&(this.velocity.z+=u*t,n=!0),this.input.keys.d&&(this.velocity.x+=u*t,n=!0),this.input.keys.space&&!this.sneak?this.gravity?this.canDoubleJump&&(this.velocity.y=14,this.velocity.x*=3,this.velocity.z*=3,this.canDoubleJump=!1):this.canJump&&(this.velocity.y=8.5,this.canJump=!1,this.gravity=!0,this.doubleJumpFlag=!0):this.doubleJumpFlag&&(this.canDoubleJump=!0,this.doubleJumpFlag=!1),n?(this.gravity=!0,this.canJump=!1):void 0},e.prototype.hitCheck=function(t){var e,r,n,i,o,s,u,a,h,c,l,f,p,y,d;if(n=.001,f=this.position.clone(),this.translateX(this.velocity.x*t),this.translateZ(this.velocity.z*t),this.translateY(this.velocity.y*t),h={x:this.position.x-f.x,z:this.position.z-f.z,y:this.position.y-f.y},this.position.copy(f),this.sneak){for(p=["x","z"],i=0,s=p.length;s>i;i++)if(e=p[i],a=h[e],!(Math.abs(a)<n))if(c=this.position[e],this.position[e]+=a,r=this.getAroundColliders(e,0>a?-1:1),this.collides(r))this.position[e]=c;else{if(h.y>0)continue;l=this.position.y,this.position.y-=.5,r=this.getAroundColliders("y",-1),this.collides(r)||(this.position[e]=c),this.position.y=l}return this.velocity.y=0,this.gravity=!1}for(y=["x","z","y"],d=[],o=0,u=y.length;u>o;o++)e=y[o],a=h[e],Math.abs(a)<n||(c=this.position[e],this.position[e]+=a,r=this.getAroundColliders(e,0>a?-1:1),this.collides(r)?(this.position[e]=c,"y"===e?(this.velocity.y=0,0>a?(this.canJump=!0,this.canDoubleJump=!1,this.doubleJumpFlag=!1,d.push(this.gravity=!1)):d.push(void 0)):d.push(void 0)):d.push(void 0));return d},e.prototype.update=function(t){return this.pickFlag&&this.pick(),this.action(t),this.hitCheck(t)},e}(THREE.Object3D),e.exports=i},{"./input":5,util:4}],8:[function(t,e,r){var n,i,o,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;n=t("./input"),s=t("./world"),o=function(){function t(t,e){var r,i;this.renderer=t,this.transit=e,this.clock=new THREE.Clock,this.input=new n(document.body),this.scene=new THREE.Scene,i=window.innerWidth,r=window.innerHeight,this.camera=new THREE.PerspectiveCamera(72,i/r,.1,1e3)}return t.prototype.update=function(){return this.renderer.render(this.scene,this.camera)},t}(),i=function(t){function e(t,r){this.renderer=t,this.transit=r,e.__super__.constructor.call(this,this.renderer,this.transit),this.scene.fog=new THREE.Fog(16777215,100,1e3),this.controls=new THREE.PointerLockControls(this.camera),this.scene.add(this.controls.getObject()),this.world=new s(this.renderer,this.scene,this.input,this.camera,64),this.world.syncCamera(this.controls),this.input.onMouseDown(THREE.MOUSE.LEFT,function(t){return function(){return document.pointerLockElement?void 0:(t.controls.enabled=!0,document.body.requestPointerLock())}}(this))}return u(e,t),e.prototype.update=function(){var t;return this.controls.enabled&&(t=this.clock.getDelta(),t=Math.min(1/60,t),this.world.update(t),this.world.syncCamera(this.controls)),e.__super__.update.call(this)},e}(o),e.exports=i},{"./input":5,"./world":11}],9:[function(t,e,r){var n,i;i=t("./util"),n=function(){function t(t,e,r,n,o){this.world=t,this.size=e,this.heightMin=null!=r?r:0,this.heightRange=null!=n?n:128,this.seed=null!=o?o:void 0,this.dir=[[0,1,0],[-1,0,0],[1,0,0],[0,0,-1],[0,0,1],[0,-1,0]],this.faceTemp=[[[0,1,0],[0,1,1],[1,1,0],[1,1,1]],[[0,1,0],[0,0,0],[0,1,1],[0,0,1]],[[1,1,1],[1,0,1],[1,1,0],[1,0,0]],[[1,1,0],[1,0,0],[0,1,0],[0,0,0]],[[0,1,1],[0,0,1],[1,1,1],[1,0,1]],[[1,0,1],[0,0,1],[1,0,0],[0,0,0]]],this.indexTemp=[[0,1,2],[2,1,3]],this.size2=this.size*this.size,null==this.seed&&(this.seed=i.rand(1e6)),this.cell=new Uint8Array(this.size2*this.heightRange),this.cellFace=new Int32Array(this.size2*this.heightRange*6),this.faceNum=0,this.generateMesh(32,.5,this.heightMin,this.heightMin+this.heightRange-1),console.log("seed: "+this.seed)}return t.prototype.getCell=function(t,e,r){var n;return n={x:Math.floor(t),y:Math.floor(e),z:Math.floor(r)}},t.prototype.getIndex=function(t,e,r){return 0>t||t>this.size-1?-1:0>r||r>this.size-1?-1:e<this.heightMin||e>this.heightMin+this.heightRange-1?-1:t+r*this.size+e*this.size2},t.prototype.getIndex2=function(t,e,r){var n;return n=this.getCell(t,e,r),t=n.x,e=n.y,r=n.z,0>t||t>this.size-1?-1:0>r||r>this.size-1?-1:e<this.heightMin||e>this.heightMin+this.heightRange-1?-1:t+r*this.size+e*this.size2},t.prototype.getType=function(t,e,r){var n;return n=this.getIndex(t,e,r),0>n?0:this.cell[n]},t.prototype.getFaceIndex=function(t,e){return this.cellFace[6*t+e]},t.prototype.setFaceIndex=function(t,e,r){return this.cellFace[6*t+e]=r},t.prototype.getFaceFromNormal=function(t,e,r){return t*t*(3+t)/2+e*e*(5-5*e)/2+r*r*(7+r)/2},t.prototype.getInvFaceFromNormal=function(t,e,r){return t*t*(3-t)/2+e*e*(5+5*e)/2+r*r*(7-r)/2},t.prototype.getColor=function(t){var e,r,n,i;switch(e=new THREE.Color(0),i=new THREE.Color(1118481),r=new THREE.Color(9127187),n=new THREE.Color(2263842),t){case 0:return[e,e,e,e,e,e];case 1:return[r,r,r,r,r,r];case 2:return[n,r,r,r,r,r];default:return[i,i,i,i,i,i]}},t.prototype.removeFace=function(t,e,r){var n,i,o,s,u,a,h,c,l,f,p,y,d,g,m,v,E,w,b,x;if(n=this.geometry.attributes,y=n.position,p=n.normal,i=n.color,a=n.index,s=this.getFaceIndex(t,e),-1!==s&&(this.setFaceIndex(t,e,-1),this.faceNum--,x=6*this.faceNum,s!==x)){for(d=[0,1,2,5],g=[],c=0,l=d.length;l>c;c++){for(u=d[c],o=3*a.array[s+u],m=3*a.array[x+u],r(o,3),b=[],w=[],h=f=0;3>f;h=++f)b.push(y.array[m+h]),y.array[o+h]=y.array[m+h],w.push(p.array[m+h]),p.array[o+h]=p.array[m+h],i.array[o+h]=i.array[m+h];0===u?(E=this.getIndex2(b[0],b[1],b[2]),v=this.getFaceFromNormal(w[0],w[1],w[2]),g.push(this.setFaceIndex(E,v,s))):g.push(void 0)}return g}},t.prototype.addFace=function(t,e,r,n,o){var s,u,a,h,c,l,f,p,y,d,g;return s=this.geometry.attributes,p=s.position,l=s.normal,a=s.color,c=s.index,d=6*this.faceNum,y=c.array[d-1]+1,g=3*y,u=this.getColor(o)[n],f=1e-5,h=this.getIndex(t,e,r),this.setFaceIndex(h,n,d),this.indexTemp.forEach(function(t,e){return c.array[d+3*e]=t[0]+y,c.array[d+3*e+1]=t[1]+y,c.array[d+3*e+2]=t[2]+y}),this.faceTemp[n].forEach(function(o){return function(s){return p.array[g]=s[0]+t+(s[0]<.5?f:-f),p.array[g+1]=s[1]+e+(s[1]<.5?f:-f),p.array[g+2]=s[2]+r+(s[2]<.5?f:-f),l.array[g]=o.dir[n][0],l.array[g+1]=o.dir[n][1],l.array[g+2]=o.dir[n][2],a.array[g]=u.r+i.randf(u.r/4),a.array[g+1]=u.g+i.randf(u.g/4),a.array[g+2]=u.b+i.randf(u.b/4),g+=3}}(this)),this.faceNum++},t.prototype.removeBlock=function(t,e,r){var n,i,o,s,u,a,h,c,l,f,p,y,d,g,m,v,E,w;if(u=this.getIndex(t,e,r),!(0>u)){for(this.cell[u]=0,l=[],o=a=0;6>a;o=++a)this.removeFace(u,o,function(t,e){var r;return r=!0,_.forEach(l,function(n,i){var o,s;return n[0]+n[1]<t?!0:t+e<n[0]?!0:(s=Math.min(n[0],t),o=Math.max(n[0]+n[1],t+e),l[i][0]=s,l[i][1]=o-s,r=!1)}),r?l.push([t,e]):void 0});for(y=6*this.faceNum,p=this.geometry.attributes.index.array[y-1]+1,d=3*p,E=d,m=0,w=y,v=0,f=this.dir,c=0,h=f.length;h>c;c++)n=f[c],g=this.getType(t+n[0],e+n[1],r+n[2]),0!==g&&(i=this.getInvFaceFromNormal(n[0],n[1],n[2]),this.addFace(t+n[0],e+n[1],r+n[2],i,g),v+=6,m+=12);return m>0&&(s=!0,_.forEach(l,function(t,e){var r,n;return t[0]+t[1]<E?!0:E+m<t[0]?!0:(n=Math.min(t[0],E),r=Math.max(t[0]+t[1],E+m),l[e][0]=n,l[e][1]=r-n,s=!1)}),s&&l.push([E,m])),v>0&&this.updateGeometry("index",[[w,v]]),l.length>0&&(this.updateGeometry("position",l),this.updateGeometry("color",l),this.updateGeometry("normal",l)),this.geometry.drawcalls[0].count=6*this.faceNum}},t.prototype.addBlock=function(t,e,r,n){var i,o,s,u,a,h,c,l,f,p,y,d,g,m,v,E,w,b;if(u=this.getIndex(t,e,r),!(0>u)){for(this.cell[u]=n,f=[],p=this.dir,a=0,h=p.length;h>a;a++)i=p[a],n=this.getType(t+i[0],e+i[1],r+i[2]),0!==n&&(u=this.getIndex(t+i[0],e+i[1],r+i[2]),o=this.getInvFaceFromNormal(i[0],i[1],i[2]),this.removeFace(u,o,function(t,e){var r;return r=!0,_.forEach(f,function(n,i){var o,s;return n[0]+n[1]<t?!0:t+e<n[0]?!0:(s=Math.min(n[0],t),o=Math.max(n[0]+n[1],t+e),f[i][0]=s,f[i][1]=o-s,r=!1)}),r?f.push([t,e]):void 0}));for(g=6*this.faceNum,d=this.geometry.attributes.index.array[g-1]+1,m=3*d,w=m,v=0,b=g,E=0,y=this.dir,l=0,c=y.length;c>l;l++)i=y[l],n=this.getType(t+i[0],e+i[1],r+i[2]),0===n&&(o=this.getFaceFromNormal(i[0],i[1],i[2]),this.addFace(t,e,r,o,this.getType(t,e,r)),E+=6,v+=12);return v>0&&(s=!0,_.forEach(f,function(t,e){var r,n;return t[0]+t[1]<w?!0:w+v<t[0]?!0:(n=Math.min(t[0],w),r=Math.max(t[0]+t[1],w+v),f[e][0]=n,f[e][1]=r-n,s=!1)}),s&&f.push([w,v])),E>0&&this.updateGeometry("index",[[b,E]]),f.length>0&&(this.updateGeometry("position",f),this.updateGeometry("color",f),this.updateGeometry("normal",f)),this.geometry.drawcalls[0].count=6*this.faceNum,this.geometry.computeBoundingBox()}},t.prototype.updateGeometry=function(t,e){var r,n,i,o,s,u,a,h,c,l,f;for(r=this.world.renderer.context,i=this.geometry.attributes,n=i[t],o="index"===t?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER,r.bindBuffer(o,n.buffer),f=[],a=0,h=e.length;h>a;a++)l=e[a],c=l[0],s=l[1],u=n.array.subarray(c,c+s),r.bufferSubData(o,c*n.array.BYTES_PER_ELEMENT,u),f.push(u=null);return f},t.prototype.getCollider=function(t,e,r){return[new THREE.Vector3(t,e,r),new THREE.Vector3(t+1,e+1,r+1)]},t.prototype.getHeight=function(t,e){var r,n,i,o,s,u;for(i=t+e*this.size,n=this.heightMin+this.heightRange-1,r=o=s=n,u=this.heightMin;u>=s?u>=o:o>=u;r=u>=s?++o:--o)if(0!==this.cell[i+r*this.size2])return r;return this.heightMin},t.prototype.generateMesh=function(t,e,r,n){var o,s,u,a,h,c,l,f;return a=new Int16Array(this.size2),u=this.size2*(this.heightMin+this.heightRange-1)*3,console.log("faceMax: "+u),function(o){return function(){var s,u,h,c,l,f,p,y,d,g,m,v,E;for(s=r,u=n,h=f=0,g=o.size2;g>=0?g>f:f>g;h=g>=0?++f:--f){for(v=(h%o.size+2)/2,E=((h/o.size|0)+3)/2,d=2,l=p=0;4>p;l=++p)a[h]+=i.noise(v/d,E/d,o.seed)*d,d*=4;for(a[h]=~~Math.max(r,Math.min(n,a[h]*e+t)),c=y=0,m=a[h];m>=0?m>=y:y>=m;c=m>=0?++y:--y)c===a[h]?o.cell[h+c*o.size2]=2:o.cell[h+c*o.size2]=1;s=Math.max(s,a[h]),u=Math.min(u,a[h])}return console.log("height: ["+u+", "+s+"]")}}(this)(),this.geometry=new THREE.BufferGeometry,this.material=new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors}),f=new Float32Array(4*u*3),h=new Uint32Array(2*u*3),c=new Float32Array(4*u*3),o=new Float32Array(4*u*3),s=0,l=1e-5,this.cell.forEach(function(t){return function(e,r){var n,u,a,p,y,d;{if(0!==e)return p=r%t.size,d=r%t.size2/t.size|0,y=r/t.size2|0,n=t.getColor(t.getType(p,y,d)),t.dir.forEach(function(e,u){var a;return a=t.getType(p+e[0],y+e[1],d+e[2]),0===a?(t.faceNum++,t.faceTemp[u].forEach(function(t,e){var r;return f[12*s+3*e+0]=t[0]+p+(t[0]<.5?l:-l),f[12*s+3*e+1]=t[1]+y+(t[1]<.5?l:-l),f[12*s+3*e+2]=t[2]+d+(t[2]<.5?l:-l),c[12*s+3*e+0]=1===u?-1:2===u?1:0,c[12*s+3*e+1]=5===u?-1:0===u?1:0,c[12*s+3*e+2]=3===u?-1:4===u?1:0,r=n[u],o[12*s+3*e+0]=r.r+i.randf(r.r/4),o[12*s+3*e+1]=r.g+i.randf(r.g/4),o[12*s+3*e+2]=r.b+i.randf(r.b/4)}),t.cellFace[6*r+u]=6*s,t.indexTemp.forEach(function(t,e){return h[6*s+3*e+0]=t[0]+4*s,h[6*s+3*e+1]=t[1]+4*s,h[6*s+3*e+2]=t[2]+4*s}),s++):t.cellFace[6*r+u]=-1});for(u=a=0;6>a;u=++a)t.cellFace[6*r+u]=-1}}}(this)),this.geometry.addAttribute("position",new THREE.DynamicBufferAttribute(f,3)),this.geometry.addAttribute("index",new THREE.DynamicBufferAttribute(h,3)),this.geometry.addAttribute("normal",new THREE.DynamicBufferAttribute(c,3)),this.geometry.addAttribute("color",new THREE.DynamicBufferAttribute(o,3)),this.geometry.computeBoundingSphere(),this.geometry.drawcalls.push({start:0,count:2*this.faceNum*3,index:0}),this.mesh=new THREE.Mesh(this.geometry,this.material)},t}(),e.exports=n},{"./util":10}],10:[function(t,e,r){var n;n=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t.noise=function(){var t;return t=new ImprovedNoise,function(e,r,n){return t.noise(e,r,n)}}(),t}(),e.exports=n},{}],11:[function(t,e,r){var n,i,o;i=t("./terrain"),n=t("./player"),o=function(){function t(t,e,r,o,s){var u;this.renderer=t,this.scene=e,this.input=r,this.camera=o,this.size=s,u=128,this.terrain=new i(this,this.size,0,u,599774),this.scene.add(this.terrain.mesh),this.light=new THREE.DirectionalLight(16777215,.6),this.light.position.set(.5,.7,.3).normalize(),this.scene.add(this.light),this.light2=new THREE.HemisphereLight(16777215,1118481,.6),this.scene.add(this.light2),this.player=new n(this,this.size/2,this.terrain.getHeight(this.size/2,this.size/2)+128,this.size/2)}return t.prototype.update=function(t){return this.player.update(t)},t.prototype.syncCamera=function(t){var e;return e=this.player.position.clone().add(new THREE.Vector3(0,this.player.height-.75,0)),t.getObject().position.copy(e),this.player.rotation.copy(t.getObject().rotation)},t}(),e.exports=o},{"./player":7,"./terrain":9}]},{},[6]);
//# sourceMappingURL=bundle.js.map