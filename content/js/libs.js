var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,o,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,o=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=o,t.appendChild(n)}};"object"==typeof module&&(module.exports=Detector);var ImprovedNoise=function(){function e(e){return e*e*e*(e*(6*e-15)+10)}function t(e,t,o){return t+e*(o-t)}function o(e,t,o,n){var i=15&e,a=8>i?t:o,r=4>i?o:12==i||14==i?t:n;return(0==(1&i)?a:-a)+(0==(2&i)?r:-r)}for(var n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=0;256>i;i++)n[256+i]=n[i];return{noise:function(i,a,r){var s=~~i,c=~~a,h=~~r,l=255&s,d=255&c,u=255&h;i-=s,a-=c,r-=h;var m=i-1,p=a-1,E=r-1,f=e(i),b=e(a),g=e(r),y=n[l]+d,v=n[y]+u,T=n[y+1]+u,R=n[l+1]+d,w=n[R]+u,x=n[R+1]+u;return t(g,t(b,t(f,o(n[v],i,a,r),o(n[w],m,a,r)),t(f,o(n[T],i,p,r),o(n[x],m,p,r))),t(b,t(f,o(n[v+1],i,a,E),o(n[w+1],m,a,r-1)),t(f,o(n[T+1],i,p,E),o(n[x+1],m,p,E))))}}};THREE.OrbitControls=function(e,t){function o(){return 2*Math.PI/60/60*p.autoRotateSpeed}function n(){return Math.pow(.95,p.zoomSpeed)}function i(e){if(p.enabled!==!1){if(e.preventDefault(),e.button===p.mouseButtons.ORBIT){if(p.noRotate===!0)return;z=k.ROTATE,f.set(e.clientX,e.clientY)}else if(e.button===p.mouseButtons.ZOOM){if(p.noZoom===!0)return;z=k.DOLLY,x.set(e.clientX,e.clientY)}else if(e.button===p.mouseButtons.PAN){if(p.noPan===!0)return;z=k.PAN,y.set(e.clientX,e.clientY)}z!==k.NONE&&(document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",r,!1),p.dispatchEvent(D))}}function a(e){if(p.enabled!==!1){e.preventDefault();var t=p.domElement===document?p.domElement.body:p.domElement;if(z===k.ROTATE){if(p.noRotate===!0)return;b.set(e.clientX,e.clientY),g.subVectors(b,f),p.rotateLeft(2*Math.PI*g.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*g.y/t.clientHeight*p.rotateSpeed),f.copy(b)}else if(z===k.DOLLY){if(p.noZoom===!0)return;H.set(e.clientX,e.clientY),M.subVectors(H,x),M.y>0?p.dollyIn():M.y<0&&p.dollyOut(),x.copy(H)}else if(z===k.PAN){if(p.noPan===!0)return;v.set(e.clientX,e.clientY),T.subVectors(v,y),p.pan(T.x,T.y),y.copy(v)}z!==k.NONE&&p.update()}}function r(){p.enabled!==!1&&(document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",r,!1),p.dispatchEvent(V),z=k.NONE)}function s(e){if(p.enabled!==!1&&p.noZoom!==!0&&z===k.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?p.dollyOut():0>t&&p.dollyIn(),p.update(),p.dispatchEvent(D),p.dispatchEvent(V)}}function c(e){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0)switch(e.keyCode){case p.keys.UP:p.pan(0,p.keyPanSpeed),p.update();break;case p.keys.BOTTOM:p.pan(0,-p.keyPanSpeed),p.update();break;case p.keys.LEFT:p.pan(p.keyPanSpeed,0),p.update();break;case p.keys.RIGHT:p.pan(-p.keyPanSpeed,0),p.update()}}function h(e){if(p.enabled!==!1){switch(e.touches.length){case 1:if(p.noRotate===!0)return;z=k.TOUCH_ROTATE,f.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;z=k.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);x.set(0,n);break;case 3:if(p.noPan===!0)return;z=k.TOUCH_PAN,y.set(e.touches[0].pageX,e.touches[0].pageY);break;default:z=k.NONE}z!==k.NONE&&p.dispatchEvent(D)}}function l(e){if(p.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=p.domElement===document?p.domElement.body:p.domElement;switch(e.touches.length){case 1:if(p.noRotate===!0)return;if(z!==k.TOUCH_ROTATE)return;b.set(e.touches[0].pageX,e.touches[0].pageY),g.subVectors(b,f),p.rotateLeft(2*Math.PI*g.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*g.y/t.clientHeight*p.rotateSpeed),f.copy(b),p.update();break;case 2:if(p.noZoom===!0)return;if(z!==k.TOUCH_DOLLY)return;var o=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(o*o+n*n);H.set(0,i),M.subVectors(H,x),M.y>0?p.dollyOut():M.y<0&&p.dollyIn(),x.copy(H),p.update();break;case 3:if(p.noPan===!0)return;if(z!==k.TOUCH_PAN)return;v.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(v,y),p.pan(T.x,T.y),y.copy(v),p.update();break;default:z=k.NONE}}}function d(){p.enabled!==!1&&(p.dispatchEvent(V),z=k.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var u,m,p=this,E=1e-6,f=new THREE.Vector2,b=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,v=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector2,H=new THREE.Vector2,M=new THREE.Vector2,O=0,j=0,L=1,P=new THREE.Vector3,A=new THREE.Vector3,N=new THREE.Quaternion,k={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},z=k.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var I=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),S=I.clone().inverse(),C={type:"change"},D={type:"start"},V={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=o()),j-=e},this.rotateUp=function(e){void 0===e&&(e=o()),O-=e},this.panLeft=function(e){var t=this.object.matrix.elements;R.set(t[0],t[1],t[2]),R.multiplyScalar(-e),P.add(R)},this.panUp=function(e){var t=this.object.matrix.elements;R.set(t[4],t[5],t[6]),R.multiplyScalar(e),P.add(R)},this.pan=function(e,t){var o=p.domElement===document?p.domElement.body:p.domElement;if(p.object instanceof THREE.PerspectiveCamera){var n=p.object.position,i=n.clone().sub(p.target),a=i.length();a*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*e*a/o.clientHeight),p.panUp(2*t*a/o.clientHeight)}else p.object instanceof THREE.OrthographicCamera?(p.panLeft(e*(p.object.right-p.object.left)/o.clientWidth),p.panUp(t*(p.object.top-p.object.bottom)/o.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=n()),p.object instanceof THREE.PerspectiveCamera?L/=e:p.object instanceof THREE.OrthographicCamera?(p.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),p.object.updateProjectionMatrix(),p.dispatchEvent(C)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=n()),p.object instanceof THREE.PerspectiveCamera?L*=e:p.object instanceof THREE.OrthographicCamera?(p.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),p.object.updateProjectionMatrix(),p.dispatchEvent(C)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var e=this.object.position;w.copy(e).sub(this.target),w.applyQuaternion(I),u=Math.atan2(w.x,w.z),m=Math.atan2(Math.sqrt(w.x*w.x+w.z*w.z),w.y),this.autoRotate&&z===k.NONE&&this.rotateLeft(o()),u+=j,m+=O,u=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,u)),m=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,m)),m=Math.max(E,Math.min(Math.PI-E,m));var t=w.length()*L;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(P),w.x=t*Math.sin(m)*Math.sin(u),w.y=t*Math.cos(m),w.z=t*Math.sin(m)*Math.cos(u),w.applyQuaternion(S),e.copy(this.target).add(w),this.object.lookAt(this.target),j=0,O=0,L=1,P.set(0,0,0),(A.distanceToSquared(this.object.position)>E||8*(1-N.dot(this.object.quaternion))>E)&&(this.dispatchEvent(C),A.copy(this.object.position),N.copy(this.object.quaternion))},this.reset=function(){z=k.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(C),this.update()},this.getPolarAngle=function(){return m},this.getAzimuthalAngle=function(){return u},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",c,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,o=new THREE.Sphere,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3;return function(r,s){var c=this.geometry;if(null===c.boundingSphere&&c.computeBoundingSphere(),o.copy(c.boundingSphere),o.applyMatrix4(this.matrixWorld),r.ray.isIntersectionSphere(o)!==!1&&(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===c.boundingBox||t.isIntersectionBox(c.boundingBox)!==!1))if(c instanceof THREE.BufferGeometry){var h=this.material;if(void 0===h)return;var l,d,u,m=c.attributes,p=r.precision;if(void 0!==m.index){var E=m.index.array,f=m.position.array,b=c.offsets;0===b.length&&(b=[{start:0,count:E.length,index:0}]);for(var g=0,y=b.length;y>g;++g)for(var v=b[g].start,T=b[g].count,R=b[g].index,w=v,x=v+T;x>w;w+=3){if(l=R+E[w],d=R+E[w+1],u=R+E[w+2],n.fromArray(f,3*l),i.fromArray(f,3*d),a.fromArray(f,3*u),h.side===THREE.BackSide)var H=t.intersectTriangle(a,i,n,!0);else var H=t.intersectTriangle(n,i,a,h.side!==THREE.DoubleSide);if(null!==H){H.applyMatrix4(this.matrixWorld);var M=r.ray.origin.distanceTo(H);p>M||M<r.near||M>r.far||s.push({distance:M,point:H,face:new THREE.Face3(l,d,u,THREE.Triangle.normal(n,i,a)),faceIndex:w,object:this})}}}else for(var f=m.position.array,w=0,O=0,x=f.length;x>w;w+=3,O+=9){if(l=w,d=w+1,u=w+2,n.fromArray(f,O),i.fromArray(f,O+3),a.fromArray(f,O+6),h.side===THREE.BackSide)var H=t.intersectTriangle(a,i,n,!0);else var H=t.intersectTriangle(n,i,a,h.side!==THREE.DoubleSide);if(null!==H){H.applyMatrix4(this.matrixWorld);var M=r.ray.origin.distanceTo(H);p>M||M<r.near||M>r.far||s.push({distance:M,point:H,face:new THREE.Face3(l,d,u,THREE.Triangle.normal(n,i,a)),faceIndex:null,object:this})}}}else if(c instanceof THREE.Geometry)for(var l,d,u,j=this.material instanceof THREE.MeshFaceMaterial,L=j===!0?this.material.materials:null,p=r.precision,P=c.vertices,A=0,N=c.faces.length;N>A;A++){var k=c.faces[A],h=j===!0?L[k.materialIndex]:this.material;if(void 0!==h){if(l=P[k.a],d=P[k.b],u=P[k.c],h.morphTargets===!0){var z=c.morphTargets,I=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),a.set(0,0,0);for(var S=0,C=z.length;C>S;S++){var D=I[S];if(0!==D){var V=z[S].vertices;n.x+=(V[k.a].x-l.x)*D,n.y+=(V[k.a].y-l.y)*D,n.z+=(V[k.a].z-l.z)*D,i.x+=(V[k.b].x-d.x)*D,i.y+=(V[k.b].y-d.y)*D,i.z+=(V[k.b].z-d.z)*D,a.x+=(V[k.c].x-u.x)*D,a.y+=(V[k.c].y-u.y)*D,a.z+=(V[k.c].z-u.z)*D}}n.add(l),i.add(d),a.add(u),l=n,d=i,u=a}if(h.side===THREE.BackSide)var H=t.intersectTriangle(u,d,l,!0);else var H=t.intersectTriangle(l,d,u,h.side!==THREE.DoubleSide);if(null!==H){H.applyMatrix4(this.matrixWorld);var M=r.ray.origin.distanceTo(H);p>M||M<r.near||M>r.far||s.push({distance:M,point:H,face:k,faceIndex:A,object:this})}}}}}(),THREE.PointerLockControls=function(e){var t=this;e.rotation.set(0,0,0);var o=new THREE.Object3D;o.add(e);var n=new THREE.Object3D;n.position.y=10,n.add(o);var i=Math.PI/2,a=function(e){if(t.enabled!==!1){var a=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;n.rotation.y-=.002*a,o.rotation.x-=.002*r,o.rotation.x=Math.max(-i,Math.min(i,o.rotation.x))}};document.addEventListener("mousemove",a,!1),this.enabled=!1,this.getObject=function(){return n},this.getDirection=function(){var e=new THREE.Vector3(0,0,-1),t=new THREE.Euler(0,0,0,"YXZ");return function(i){return t.set(o.rotation.x,n.rotation.y,0),i.copy(e).applyEuler(t),i}}()};