{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/input.coffee","bundle.js","src/main.coffee","src/scene.coffee","src/util.coffee"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","Input","indexOf","item","this","hasProp","hasOwnProperty","domElement","buttons","keydown","keyup","mapper","mouseEvent","ref","ref1","ref2","ref3","document","keys","listener","keyMap",8,13,16,17,18,27,32,37,38,39,40,"_this","keycode","status","key","String","fromCharCode","toLowerCase","Bacon","fromEventTarget","map","keyCode","merge","filter","charCodeAt","onValue","forEach","v","THREE","MOUSE","LEFT","RIGHT","type","button","clientX","clientY","btn","cb","push","_","remove","onMouseDown","offMouseDown","onMouseUp","offMouseUp","transform","res","bind","onDoubleClick","offDoubleClick","active","md","mu","k","results","onMouseMove","offMouseMove","offAll","ref4","off","prototype","on","allremove",2,"Main","Scene","util","transit","Detector","webgl","addGetWebGLMessage","renderer","WebGLRenderer","alpha","antialiasing","setSize","window","innerWidth","innerHeight","setClearColor","autoClear","sortObjects","$","append","currentScene","input","stats","Stats","setMode","style","position","left","top","body","resize","height","width","camera","aspect","updateProjectionMatrix","animate","requestAnimationFrame","begin","clear","update","end","./scene","./util",3,"OrbitScene","PLScene","extend","child","parent","ctor","constructor","__super__","clock","Clock","scene","PerspectiveCamera","render","superClass","geometry","material","z","controls","OrbitControls","BoxGeometry","MeshPhongMaterial","color","wireframe","mesh","Mesh","add","light","DirectionalLight","set","normalize","console","log","PointerLockControls","getObject","MeshBasicMaterial","enabled","pointerLockElement","requestPointerLock","exitPointerLock","./input",4,"Utility","rand","Math","floor","random","randRange","min","max","randArray","arr","noise","perlin","ImprovedNoise","x","y"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","class Input\r\n  constructor: (@domElement = document)->\r\n    @keys = {}\r\n    @listener = {}\r\n\r\n    @keyMap =\r\n      8: 'backspace'\r\n      13: 'enter'\r\n      16: 'shift'\r\n      17: 'ctrl'\r\n      18: 'alt'\r\n      27: 'esc'\r\n      32: 'space'\r\n      37: 'left'\r\n      38: 'up'\r\n      39: 'right'\r\n      40: 'down'\r\n\r\n    mapper = (keycode, status)=>\r\n      key: @keyMap[keycode] or String.fromCharCode(keycode).toLowerCase()\r\n      status: status\r\n\r\n    keydown = Bacon.fromEventTarget(@domElement, 'keydown').map (e)=> mapper.call @, e.keyCode, true\r\n    keyup = Bacon.fromEventTarget(@domElement, 'keyup').map (e)=> mapper.call @, e.keyCode, false\r\n    keydown.merge(keyup).filter (e)->\r\n      code = e.key.charCodeAt 0\r\n      47 < code < 58 or 96 < code < 123\r\n    .onValue (e)=>\r\n      @keys[e.key] = e.status\r\n      return unless e.status \r\n      @listener[e.key]?.forEach (v)-> do v\r\n\r\n    buttons = [THREE.MOUSE.LEFT, THREE.MOUSE.RIGHT]\r\n    \r\n    mouseEvent = (type)=>\r\n      listener = {}\r\n      buttons.forEach (e)-> listener[e] = []\r\n      Bacon.fromEventTarget @domElement, type\r\n        .filter (e)-> e.button in buttons\r\n        .onValue (e)-> listener[e.button].forEach (v)-> v e.clientX, e.clientY\r\n      [ \r\n        (btn, cb)-> listener[btn]?.push cb,\r\n        (btn, cb)-> _.remove listener[btn], (v)-> if cb? then v is cb else true\r\n      ]\r\n\r\n    [@onMouseDown, @offMouseDown] = mouseEvent 'mousedown'\r\n    [@onMouseUp, @offMouseUp] = mouseEvent 'mouseup'\r\n    [@onDoubleClick, @offDoubleClick] = _.transform mouseEvent('dblclick'), (res, e)-> res.push e.bind @, THREE.MOUSE.LEFT\r\n\r\n    [@onMouseMove, @offMouseMove] = do =>\r\n      listener = {}\r\n      active = {}\r\n      buttons.forEach (e)-> \r\n        active[e] = false\r\n        listener[e] = []\r\n      md = Bacon.fromEventTarget(@domElement, 'mousedown').map (e)-> [e.button, true]\r\n      mu = Bacon.fromEventTarget(@domElement, 'mouseup').map (e)-> [e.button, false]\r\n      md.merge(mu).onValue (e)-> active[e[0]] = e[1] if active[e[0]]?\r\n      Bacon.fromEventTarget(@domElement, 'mousemove').onValue (e)->\r\n        for own k, v of listener\r\n          v.forEach (u)-> u e.clientX, e.clientY if active[k] \r\n      [\r\n        (btn, cb)-> listener[btn]?.push cb,\r\n        (btn, cb)-> _.remove listener[btn], (v)-> if cb? then v is cb else true\r\n      ]\r\n\r\n    @offAll = =>\r\n      buttons.forEach (v)=>\r\n        @offMouseDown v\r\n        @offMouseUp v\r\n        @offMouseMove v\r\n      @offDoubleClick()\r\n      @off k for own k, v of @listener\r\n        \r\n\r\n  on: (key, cb)->\r\n    return @listener[key].push cb if @listener[key]\r\n    @listener[key] = [cb]\r\n\r\n  off: (key, cb = allremove)->\r\n    _.remove @listener[key], (v)-> v is cb\r\n\r\n\r\nmodule.exports = Input",null,"'use strict'\r\n\r\nutil = require './util'\r\nScene = require './scene'\r\n\r\n\r\nclass Main\r\n  constructor: -> \r\n    Detector.addGetWebGLMessage() unless Detector.webgl\r\n\r\n    @renderer = new THREE.WebGLRenderer\r\n        alpha: true\r\n        antialiasing: true\r\n    @renderer.setSize window.innerWidth, window.innerHeight\r\n    @renderer.setClearColor 0xa0d8ef, 1\r\n    @renderer.autoClear = false\r\n    @renderer.sortObjects = true\r\n    $('#world').append @renderer.domElement\r\n\r\n    @currentScene = undefined\r\n    transit = (s)=>\r\n      @currentScene.input.offAll()\r\n      @currentScene = s\r\n\r\n    @currentScene = new Scene @renderer, transit\r\n    \r\n    @stats = new Stats\r\n    @stats.setMode 0  # 0: fps, 1: ms, 2: mb\r\n    @stats.domElement.style.position = 'absolute'\r\n    @stats.domElement.style.left = '0px'\r\n    @stats.domElement.style.top = '0px'\r\n    $(document.body).append @stats.domElement\r\n\r\n    $(window).resize =>\r\n      width = window.innerWidth\r\n      height = window.innerHeight\r\n      @renderer.setSize width, height\r\n      @currentScene.camera.aspect = width / height\r\n      @currentScene.camera.updateProjectionMatrix()\r\n\r\n  animate: ->\r\n    requestAnimationFrame => do @animate\r\n    @stats.begin()\r\n    @renderer.clear()\r\n    @currentScene?.update()\r\n    @stats.end()\r\n\r\n\r\n$ -> do new Main().animate\r\n","Input = require './input'\r\n\r\nclass Scene\r\n  constructor: (@renderer, @transit)->\r\n    @clock = new THREE.Clock\r\n    @input = new Input document.body\r\n    @scene = new THREE.Scene\r\n    @camera = new THREE.PerspectiveCamera 72, window.innerWidth / window.innerHeight, 1, 1000\r\n    \r\n  update: ->\r\n    @renderer.render @scene, @camera\r\n\r\nclass OrbitScene extends Scene\r\n  constructor: (@renderer, @transit)-> \r\n    super @renderer, @transit\r\n    @camera.position.z = 100\r\n    @controls = new THREE.OrbitControls @camera\r\n\r\n    geometry = new THREE.BoxGeometry 20, 20, 20\r\n    material = new THREE.MeshPhongMaterial\r\n        color: 0xff0000\r\n        wireframe: false\r\n    @mesh = new THREE.Mesh geometry, material\r\n    @scene.add @mesh\r\n\r\n    @light = new THREE.DirectionalLight 0xffffff, 1.0\r\n    @light.position.set(0.5, 0.7, 0.3).normalize()\r\n    @scene.add @light\r\n\r\n    @input.onMouseDown THREE.MOUSE.RIGHT, =>\r\n      console.log \"transit PLScene\"\r\n      @transit new PLScene @renderer, @transit\r\n\r\n  update: ->\r\n    @controls.update()\r\n    super()\r\n    \r\n\r\nclass PLScene extends Scene\r\n  constructor: (@renderer, @transit)-> \r\n    super @renderer, @transit\r\n    @camera.position.z = 100\r\n    @controls = new THREE.PointerLockControls @camera\r\n    @scene.add @controls.getObject()\r\n\r\n    geometry = new THREE.BoxGeometry 20, 20, 20\r\n    material = new THREE.MeshBasicMaterial\r\n        color: 0xff0000\r\n        wireframe: true\r\n    @mesh = new THREE.Mesh geometry, material\r\n    @scene.add @mesh\r\n\r\n    @input.onMouseDown THREE.MOUSE.LEFT, =>\r\n      console.log \"poyo\"\r\n      @controls.enabled = true\r\n      unless document.pointerLockElement\r\n        document.body.requestPointerLock()\r\n    \r\n    @input.onDoubleClick =>\r\n      @controls.enabled = false\r\n      if document.pointerLockElement\r\n        document.exitPointerLock()\r\n      console.log \"transit OrbitScene\"\r\n      @transit new OrbitScene @renderer, @transit\r\n      \r\n\r\nmodule.exports = OrbitScene","class Utility\r\n  @rand = (n)->\r\n    Math.floor Math.random() * n\r\n\r\n  @randRange = (min, max)->\r\n    Math.floor(Math.random() * (max - min + 1)) + min\r\n  \r\n  @randArray = (arr)->\r\n    arr[Math.floor Math.random() * arr.length]\r\n\r\n  @noise = do ->\r\n    perlin = new ImprovedNoise\r\n    (x, y, z)-> perlin.noise x, y, z\r\n\r\n\r\nmodule.exports = Utility"],"sourceRoot":"./src"}